<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HappyFoot Admin</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/11.0.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --primary: #04273b;
            --primary-hover: #063d5e;
            --accent-light: #E0F2FE;
            --bg: #F5F7FA;
            --safe-top: 60px; /* ~1.5cm visual safe area */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: #1e293b;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none; /* Prevent pull-to-refresh on mobile */
        }

        /* Hide Scrollbar but keep functionality */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }

        .safe-top-padding {
            padding-top: var(--safe-top);
        }

        .glass-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0,0,0,0.05);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.03);
        }

        .card-shadow {
            box-shadow: 0 4px 15px rgba(4, 39, 59, 0.05);
        }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- CONFIGURATION & FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyBzjaoG4jyD1pjBH9Z0XhL6ZzAp_WT4Ep4",
            authDomain: "happyfoot-lviv.firebaseapp.com",
            projectId: "happyfoot-lviv",
            storageBucket: "happyfoot-lviv.firebasestorage.app",
            messagingSenderId: "825936740538",
            appId: "1:825936740538:web:7aa5fa34a1a5f020f04283",
            measurementId: "G-CCXGKHW5BR"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // --- ICONS COMPONENT WRAPPER ---
        const Icon = ({ name, size = 20, color = "currentColor", className="" }) => {
            const LucideIcon = window.lucide && window.lucide.icons ? window.lucide.icons[name] : null;
            if (!LucideIcon) return null;
            
            // Render SVG manually since we are in a standalone script without Lucide React component
            // Or simpler: use an effect to replace <i data-lucide="...">
            // But for React within Babel standalone, we need to be clever or just use simple SVG paths or standard library if possible.
            // WORKAROUND: We will use the library's createCreateElement if available, or just simple replacement.
            // EASIER APPROACH for Standalone:
            React.useEffect(() => {
                lucide.createIcons();
            });
            return <i data-lucide={name.toLowerCase()} width={size} height={size} style={{color}} className={className}></i>;
        };

        // --- UTILS ---
        const HOURS_PRESET = ["09:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00", "16:00", "17:00", "18:00", "19:00", "20:00"];

        // --- COMPONENTS ---

        // 1. LOGIN SCREEN
        const LoginScreen = ({ onLogin }) => {
            const [pin, setPin] = React.useState("");
            const [error, setError] = React.useState(false);

            const handleAuth = () => {
                if(pin === "0000") { // üõë CHANGE THIS PIN FOR REAL USE
                    onLogin();
                } else {
                    setError(true);
                    setPin("");
                }
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center bg-[#04273b] p-6 text-white">
                    <div className="text-3xl font-bold mb-2">HappyFoot <span className="text-sky-400">Admin</span></div>
                    <div className="text-sm text-sky-200/60 mb-8 uppercase tracking-widest">–ü–∞–Ω–µ–ª—å –∫–µ—Ä—É–≤–∞–Ω–Ω—è</div>
                    
                    <input 
                        type="password" 
                        inputMode="numeric"
                        value={pin}
                        onChange={e => {setPin(e.target.value); setError(false);}}
                        className="w-48 bg-white/10 text-center text-2xl tracking-[0.5em] py-3 rounded-xl border border-white/20 focus:outline-none focus:border-sky-400 transition-all mb-4"
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                        maxLength={4}
                    />
                    {error && <div className="text-red-400 text-sm mb-4">–ù–µ–≤—ñ—Ä–Ω–∏–π PIN-–∫–æ–¥</div>}
                    
                    <button onClick={handleAuth} className="bg-sky-500 hover:bg-sky-400 text-white font-bold py-3 px-12 rounded-full transition-all shadow-lg shadow-sky-500/20">
                        –£–≤—ñ–π—Ç–∏
                    </button>
                </div>
            );
        };

        // 2. TABS CONTENT

        // --- TAB: RECORDS (–ó–ê–ü–ò–°–ò) ---
        const TabRecords = () => {
            const [apps, setApps] = React.useState([]);
            const [loading, setLoading] = React.useState(true);
            const [editModal, setEditModal] = React.useState(null);
            const [specialists, setSpecialists] = React.useState([]);

            React.useEffect(() => {
                // Fetch specialists for dropdown
                db.collection("specialists").get().then(snap => {
                    setSpecialists(snap.docs.map(d => ({id: d.id, ...d.data()})));
                });

                // Listen to appointments
                const unsub = db.collection("appointments")
                    .orderBy("date", "desc") // Temporary sort, we will sort properly in JS
                    .onSnapshot(snap => {
                        const data = snap.docs.map(d => ({id: d.id, ...d.data()}));
                        // Sort by Date then Time desc
                        data.sort((a,b) => {
                            if(a.date !== b.date) return new Date(a.date) - new Date(b.date);
                            return a.time.localeCompare(b.time);
                        });
                        setApps(data);
                        setLoading(false);
                    });
                return () => unsub();
            }, []);

            const updateStatus = async (id, status) => {
                await db.collection("appointments").doc(id).update({ status });
            };

            const deleteApp = async (id) => {
                if(confirm("–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –∑–∞–ø–∏—Å –±–µ–∑–ø–æ–≤–æ—Ä–æ—Ç–Ω–æ?")) {
                    await db.collection("appointments").doc(id).delete();
                }
            };

            const saveEdit = async () => {
                if(!editModal) return;
                const specName = specialists.find(s => s.id === editModal.specialistId)?.name || "–ù–µ –æ–±—Ä–∞–Ω–æ";
                
                await db.collection("appointments").doc(editModal.id).update({
                    date: editModal.date,
                    time: editModal.time,
                    specialistId: editModal.specialistId,
                    specialistName: specName
                });
                setEditModal(null);
            };

            if(loading) return <div className="p-8 text-center text-gray-400">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>;

            return (
                <div className="pb-24 px-4 animate-fade-in safe-top-padding">
                    <h2 className="text-2xl font-bold text-[#04273b] mb-6 pl-2 border-l-4 border-sky-400">–ñ—É—Ä–Ω–∞–ª –∑–∞–ø–∏—Å—ñ–≤</h2>
                    
                    {apps.length === 0 ? (
                        <div className="text-center py-10 text-gray-400">–ó–∞–ø–∏—Å—ñ–≤ –Ω–µ–º–∞—î</div>
                    ) : (
                        apps.map(app => (
                            <div key={app.id} className="bg-white rounded-2xl p-4 mb-4 card-shadow border border-gray-100 relative overflow-hidden">
                                {app.status === 'new' && <div className="absolute top-0 right-0 bg-blue-100 text-blue-700 text-[10px] font-bold px-2 py-1 rounded-bl-lg">–ù–û–í–ò–ô</div>}
                                {app.status === 'confirmed' && <div className="absolute top-0 right-0 bg-green-100 text-green-700 text-[10px] font-bold px-2 py-1 rounded-bl-lg">–ü–Ü–î–¢–í–ï–†–î–ñ–ï–ù–û</div>}
                                
                                <div className="flex justify-between items-start mb-2">
                                    <div>
                                        <div className="font-bold text-lg text-[#04273b]">{app.serviceName}</div>
                                        <div className="text-sm text-gray-500 flex items-center gap-1 mt-1">
                                            <Icon name="User" size={14}/> {app.name} 
                                            <a href={`tel:${app.phone}`} className="text-sky-600 font-semibold ml-2">{app.phone}</a>
                                        </div>
                                    </div>
                                    <div className="text-right">
                                        <div className="font-bold text-xl text-[#04273b]">{app.time}</div>
                                        <div className="text-xs text-gray-400 font-semibold">{app.date}</div>
                                    </div>
                                </div>

                                <div className="bg-gray-50 rounded-lg p-2 mb-3 text-xs text-gray-600 flex justify-between items-center">
                                    <span>–ú–∞–π—Å—Ç–µ—Ä: <b>{app.specialistName}</b></span>
                                    <button onClick={() => setEditModal(app)} className="text-sky-600 font-bold px-2">–†–µ–¥.</button>
                                </div>

                                <div className="grid grid-cols-2 gap-2">
                                    {app.status !== 'confirmed' && (
                                        <button onClick={() => updateStatus(app.id, 'confirmed')} className="bg-[#04273b] text-white py-2 rounded-xl text-sm font-semibold flex items-center justify-center gap-2">
                                            <Icon name="Check" size={16}/> –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏
                                        </button>
                                    )}
                                    {app.status === 'confirmed' && (
                                        <button onClick={() => updateStatus(app.id, 'new')} className="bg-gray-200 text-gray-600 py-2 rounded-xl text-sm font-semibold">
                                            –°–∫–∞—Å—É–≤–∞—Ç–∏ –ø—ñ–¥—Ç–≤.
                                        </button>
                                    )}
                                    <button onClick={() => deleteApp(app.id)} className="bg-red-50 text-red-500 py-2 rounded-xl text-sm font-semibold border border-red-100">
                                        –í–∏–¥–∞–ª–∏—Ç–∏
                                    </button>
                                </div>
                            </div>
                        ))
                    )}

                    {/* EDIT MODAL */}
                    {editModal && (
                        <div className="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4">
                            <div className="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl animate-fade-in">
                                <h3 className="font-bold text-lg mb-4">–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—É</h3>
                                
                                <label className="text-xs font-bold text-gray-400 uppercase">–î–∞—Ç–∞</label>
                                <input type="date" value={editModal.date} onChange={e => setEditModal({...editModal, date: e.target.value})} className="w-full bg-gray-50 p-3 rounded-xl mb-3 border border-gray-200"/>

                                <label className="text-xs font-bold text-gray-400 uppercase">–ß–∞—Å</label>
                                <input type="time" value={editModal.time} onChange={e => setEditModal({...editModal, time: e.target.value})} className="w-full bg-gray-50 p-3 rounded-xl mb-3 border border-gray-200"/>

                                <label className="text-xs font-bold text-gray-400 uppercase">–°–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç</label>
                                <select value={editModal.specialistId || ""} onChange={e => setEditModal({...editModal, specialistId: e.target.value})} className="w-full bg-gray-50 p-3 rounded-xl mb-6 border border-gray-200">
                                    <option value="">–ù–µ –æ–±—Ä–∞–Ω–æ</option>
                                    {specialists.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}
                                </select>

                                <div className="flex gap-3">
                                    <button onClick={saveEdit} className="flex-1 bg-[#04273b] text-white py-3 rounded-xl font-bold">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                                    <button onClick={() => setEditModal(null)} className="flex-1 bg-gray-100 text-gray-600 py-3 rounded-xl font-bold">–ó–∞–∫—Ä–∏—Ç–∏</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- TAB: STAFF (–ü–†–ê–¶–Ü–í–ù–ò–ö–ò) ---
        const TabStaff = () => {
            const [staff, setStaff] = React.useState([]);
            const [isEditing, setIsEditing] = React.useState(false);
            const [formData, setFormData] = React.useState({ name: '', role: '', hours: [] });

            React.useEffect(() => {
                const unsub = db.collection("specialists").onSnapshot(snap => {
                    setStaff(snap.docs.map(d => ({id: d.id, ...d.data()})));
                });
                return () => unsub();
            }, []);

            const toggleHour = (h) => {
                const current = formData.hours || [];
                if(current.includes(h)) {
                    setFormData({...formData, hours: current.filter(x => x !== h)});
                } else {
                    setFormData({...formData, hours: [...current, h].sort()});
                }
            };

            const handleSubmit = async () => {
                if(!formData.name) return alert("–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è");
                
                if(formData.id) {
                    await db.collection("specialists").doc(formData.id).update(formData);
                } else {
                    await db.collection("specialists").add(formData);
                }
                setIsEditing(false);
                setFormData({ name: '', role: '', hours: [] });
            };

            const deleteStaff = async (id) => {
                if(confirm("–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—å–æ–≥–æ –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∞?")) {
                    await db.collection("specialists").doc(id).delete();
                }
            };

            return (
                <div className="pb-24 px-4 animate-fade-in safe-top-padding">
                     <div className="flex justify-between items-center mb-6 pl-2 border-l-4 border-sky-400">
                        <h2 className="text-2xl font-bold text-[#04273b]">–ü—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∏</h2>
                        <button onClick={() => { setFormData({ name: '', role: '', hours: [] }); setIsEditing(true); }} className="bg-[#04273b] text-white w-10 h-10 rounded-full flex items-center justify-center shadow-lg active:scale-90 transition-transform">
                            <Icon name="Plus" size={24}/>
                        </button>
                    </div>

                    {staff.map(s => (
                        <div key={s.id} onClick={() => { setFormData(s); setIsEditing(true); }} className="bg-white rounded-2xl p-4 mb-3 card-shadow border border-gray-100 flex items-center gap-4 cursor-pointer active:bg-gray-50 transition-colors">
                            <div className="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-500 text-lg">
                                {s.name[0]}
                            </div>
                            <div className="flex-1">
                                <div className="font-bold text-[#04273b]">{s.name}</div>
                                <div className="text-xs text-gray-500">{s.role}</div>
                            </div>
                            <div className="text-xs font-bold text-sky-600 bg-sky-50 px-2 py-1 rounded-md">
                                {(s.hours || []).length} –≥–æ–¥.
                            </div>
                        </div>
                    ))}

                    {isEditing && (
                        <div className="fixed inset-0 z-50 bg-white overflow-y-auto safe-top-padding">
                            <div className="p-4">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="text-xl font-bold">{formData.id ? '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏' : '–î–æ–¥–∞—Ç–∏'} –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∞</h3>
                                    <button onClick={() => setIsEditing(false)} className="bg-gray-100 p-2 rounded-full"><Icon name="X" size={20}/></button>
                                </div>

                                <div className="space-y-4">
                                    <input placeholder="–ü–Ü–ë" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} className="w-full bg-gray-50 p-4 rounded-xl border border-gray-200 outline-none focus:border-sky-400 font-bold"/>
                                    <input placeholder="–ü–æ—Å–∞–¥–∞ (–Ω–∞–ø. –ü–æ–¥–æ–ª–æ–≥)" value={formData.role} onChange={e => setFormData({...formData, role: e.target.value})} className="w-full bg-gray-50 p-4 rounded-xl border border-gray-200 outline-none focus:border-sky-400"/>
                                    
                                    <div>
                                        <div className="text-sm font-bold text-gray-400 mb-2 uppercase">–†–æ–±–æ—á—ñ –≥–æ–¥–∏–Ω–∏</div>
                                        <div className="grid grid-cols-4 gap-2">
                                            {HOURS_PRESET.map(h => (
                                                <button key={h} onClick={() => toggleHour(h)} 
                                                    className={`py-2 rounded-lg text-sm font-semibold transition-colors ${formData.hours?.includes(h) ? 'bg-[#04273b] text-white' : 'bg-gray-100 text-gray-500'}`}>
                                                    {h}
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="pt-4 flex gap-3">
                                        <button onClick={handleSubmit} className="flex-1 bg-[#04273b] text-white py-4 rounded-xl font-bold shadow-lg shadow-sky-900/20">
                                            –ó–±–µ—Ä–µ–≥—Ç–∏
                                        </button>
                                        {formData.id && (
                                            <button onClick={() => { deleteStaff(formData.id); setIsEditing(false); }} className="px-4 bg-red-50 text-red-500 rounded-xl font-bold">
                                                <Icon name="Trash2" size={20}/>
                                            </button>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            )
        };

        // --- TAB: SERVICES (–ü–û–°–õ–£–ì–ò) ---
        const TabServices = () => {
            const [categories, setCategories] = React.useState({});
            const [selectedCatId, setSelectedCatId] = React.useState(null);
            const [isEditingItem, setIsEditingItem] = React.useState(false);
            const [itemData, setItemData] = React.useState({ name: '', price: '', desc: '' });

            React.useEffect(() => {
                const unsub = db.collection("services").onSnapshot(snap => {
                    const data = {};
                    snap.forEach(d => data[d.id] = {id: d.id, ...d.data()});
                    setCategories(data);
                    if(!selectedCatId && Object.keys(data).length > 0) setSelectedCatId(Object.keys(data)[0]);
                });
                return () => unsub();
            }, []);

            const handleSaveItem = async () => {
                if(!itemData.name || !selectedCatId) return;
                
                const catData = categories[selectedCatId];
                let newItems = [...(catData.items || [])];

                if(itemData._index !== undefined) {
                    // Edit existing
                    newItems[itemData._index] = { name: itemData.name, price: itemData.price, desc: itemData.desc };
                } else {
                    // Add new
                    newItems.push({ name: itemData.name, price: itemData.price, desc: itemData.desc });
                }

                await db.collection("services").doc(selectedCatId).update({ items: newItems });
                setIsEditingItem(false);
                setItemData({ name: '', price: '', desc: '' });
            };

            const deleteItem = async (index) => {
                if(!confirm("–í–∏–¥–∞–ª–∏—Ç–∏ –ø–æ—Å–ª—É–≥—É?")) return;
                const catData = categories[selectedCatId];
                const newItems = catData.items.filter((_, i) => i !== index);
                await db.collection("services").doc(selectedCatId).update({ items: newItems });
            };

            const currentCat = categories[selectedCatId];

            return (
                <div className="pb-24 px-4 animate-fade-in safe-top-padding">
                    <h2 className="text-2xl font-bold text-[#04273b] mb-4 pl-2 border-l-4 border-sky-400">–ü–æ—Å–ª—É–≥–∏</h2>
                    
                    {/* Category Tabs */}
                    <div className="flex gap-2 overflow-x-auto pb-4 mb-2 no-scrollbar">
                        {Object.values(categories).map(cat => (
                            <button key={cat.id} onClick={() => setSelectedCatId(cat.id)}
                                className={`whitespace-nowrap px-4 py-2 rounded-full text-sm font-bold transition-all ${selectedCatId === cat.id ? 'bg-[#04273b] text-white shadow-lg' : 'bg-white text-gray-500 border border-gray-200'}`}>
                                {cat.icon} {cat.title}
                            </button>
                        ))}
                    </div>

                    {/* Items List */}
                    {currentCat && (
                        <div>
                            <button onClick={() => { setItemData({name:'', price:'', desc:''}); setIsEditingItem(true); }} className="w-full py-3 border-2 border-dashed border-sky-200 text-sky-600 rounded-xl font-bold mb-4 flex items-center justify-center gap-2 hover:bg-sky-50 transition-colors">
                                <Icon name="Plus" size={18}/> –î–æ–¥–∞—Ç–∏ –ø–æ—Å–ª—É–≥—É
                            </button>

                            <div className="space-y-3">
                                {(currentCat.items || []).map((item, idx) => (
                                    <div key={idx} onClick={() => { setItemData({...item, _index: idx}); setIsEditingItem(true); }} className="bg-white p-4 rounded-xl border border-gray-100 card-shadow flex justify-between items-center active:bg-gray-50">
                                        <div>
                                            <div className="font-bold text-[#04273b]">{item.name}</div>
                                            <div className="text-xs text-gray-400 mt-1 max-w-[200px] truncate">{item.desc}</div>
                                        </div>
                                        <div className="font-bold text-sky-600 bg-sky-50 px-2 py-1 rounded-lg text-sm">{item.price}</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Edit Modal */}
                    {isEditingItem && (
                        <div className="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center">
                            <div className="bg-white w-full max-w-sm rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl animate-fade-in">
                                <h3 className="font-bold text-lg mb-4">{itemData._index !== undefined ? '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏' : '–ù–æ–≤–∞'} –ø–æ—Å–ª—É–≥–∞</h3>
                                
                                <input placeholder="–ù–∞–∑–≤–∞" value={itemData.name} onChange={e => setItemData({...itemData, name: e.target.value})} className="w-full bg-gray-50 p-3 rounded-xl mb-3 border border-gray-200 font-bold outline-none focus:border-sky-400"/>
                                <input placeholder="–¶—ñ–Ω–∞ (–Ω–∞–ø. 1000 ‚Ç¥)" value={itemData.price} onChange={e => setItemData({...itemData, price: e.target.value})} className="w-full bg-gray-50 p-3 rounded-xl mb-3 border border-gray-200 outline-none focus:border-sky-400"/>
                                <textarea placeholder="–û–ø–∏—Å" value={itemData.desc} onChange={e => setItemData({...itemData, desc: e.target.value})} className="w-full bg-gray-50 p-3 rounded-xl mb-4 border border-gray-200 h-24 resize-none outline-none focus:border-sky-400"></textarea>

                                <div className="flex gap-3">
                                    <button onClick={handleSaveItem} className="flex-1 bg-[#04273b] text-white py-3 rounded-xl font-bold">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                                    {itemData._index !== undefined && (
                                        <button onClick={() => { deleteItem(itemData._index); setIsEditingItem(false); }} className="px-4 bg-red-100 text-red-500 rounded-xl">
                                            <Icon name="Trash2" size={20}/>
                                        </button>
                                    )}
                                    <button onClick={() => setIsEditingItem(false)} className="px-4 bg-gray-100 text-gray-500 rounded-xl">
                                        <Icon name="X" size={20}/>
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            )
        };

        // --- MAIN APP COMPONENT ---
        const App = () => {
            const [isAuthenticated, setIsAuthenticated] = React.useState(false);
            const [activeTab, setActiveTab] = React.useState('records'); // records, staff, services

            // Check session storage for "persisted" login during refresh
            React.useEffect(() => {
                if(sessionStorage.getItem('admin_auth') === 'true') {
                    setIsAuthenticated(true);
                }
                // Trigger icon replacement
                setTimeout(() => lucide.createIcons(), 100);
            }, [activeTab]);

            const handleLogin = () => {
                sessionStorage.setItem('admin_auth', 'true');
                setIsAuthenticated(true);
            };

            if (!isAuthenticated) {
                return <LoginScreen onLogin={handleLogin} />;
            }

            return (
                <div className="min-h-screen relative max-w-[600px] mx-auto bg-[#F5F7FA]">
                    
                    {/* CONTENT */}
                    <div className="min-h-screen">
                        {activeTab === 'records' && <TabRecords />}
                        {activeTab === 'staff' && <TabStaff />}
                        {activeTab === 'services' && <TabServices />}
                    </div>

                    {/* BOTTOM NAV */}
                    <nav className="fixed bottom-0 left-0 right-0 glass-nav pb-safe-bottom z-40 max-w-[600px] mx-auto">
                        <div className="flex justify-around items-center p-2 pb-6">
                            <button onClick={() => setActiveTab('records')} className={`flex flex-col items-center p-2 transition-all ${activeTab === 'records' ? 'text-[#04273b] scale-110' : 'text-gray-400'}`}>
                                <Icon name="Calendar" size={24} />
                                <span className="text-[10px] font-bold mt-1">–ó–∞–ø–∏—Å–∏</span>
                            </button>
                            <button onClick={() => setActiveTab('staff')} className={`flex flex-col items-center p-2 transition-all ${activeTab === 'staff' ? 'text-[#04273b] scale-110' : 'text-gray-400'}`}>
                                <Icon name="Users" size={24} />
                                <span className="text-[10px] font-bold mt-1">–®—Ç–∞—Ç</span>
                            </button>
                            <button onClick={() => setActiveTab('services')} className={`flex flex-col items-center p-2 transition-all ${activeTab === 'services' ? 'text-[#04273b] scale-110' : 'text-gray-400'}`}>
                                <Icon name="Briefcase" size={24} />
                                <span className="text-[10px] font-bold mt-1">–ü–æ—Å–ª—É–≥–∏</span>
                            </button>
                        </div>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
